#!/usr/bin/env node

import {readFileSync} from 'fs';
import {fileURLToPath} from 'url';
import {dirname, join} from 'path';
import updateNotifier from 'update-notifier';
import chalk from 'chalk';
import semver from 'semver';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const pjson = JSON.parse(readFileSync(join(__dirname, '../package.json'), 'utf8'));

const notifier = updateNotifier({pkg: pjson, updateCheckInterval: 0});

if (notifier.update) {
  const {current, latest, name} = notifier.update;

  if (semver.lt(current, latest)) {
    const message = `
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 Update available ${chalk.dim(current)} → ${chalk.green(latest)}
 Run ${chalk.cyan(`npm i -g ${name}`)} to update
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    `;
    console.log(message);
  }
}

// eslint-disable-next-line unicorn/prefer-top-level-await
(async () => {
  const oclif = await import('@oclif/core');
  await oclif.execute({development: false, dir: __dirname});
})();
