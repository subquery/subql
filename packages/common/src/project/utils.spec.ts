// Copyright 2020-2021 OnFinality Limited authors & contributors
// SPDX-License-Identifier: Apache-2.0

import {createServer} from 'http';
import {findAvailablePort} from './utils';

describe('Utility', () => {
  describe('findAvailablePorts', () => {
    const port = 1337;
    it('unbound port with large range', async () => {
      expect(await findAvailablePort(port)).toEqual(port);
    });
    it('bound port single', async () => {
      const server = createServer();
      server.listen(port);
      expect(await findAvailablePort(port, 0)).toEqual(null);
      server.close();
    });
    it('bound port range partial', async () => {
      const server = createServer();
      server.listen(port);
      expect(await findAvailablePort(1337, 1)).toEqual(port + 1);
      server.close();
    });
  });
});
